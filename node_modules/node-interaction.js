var MODE = {WINDOW_MANAGEMENT: 0, APP_INTERACTION: 1};

function interaction() {
	this.selectedMoveItem = null;
	this.selectedScrollItem = null;
	this.selectOffsetX = 0;
	this.selectOffsetY = 0;
	this.selectTimeId = {};
	this.interactionMode = MODE.WINDOW_MANAGEMENT;
	
	this.CTRL = false;
	this.SHIFT = false;
	this.ALT = false;
	this.CMD = false;
	this.CAPS = false;
}

interaction.prototype.selectMoveItem = function(moveItem, pointerX, pointerY) {
	if(this.interactionMode != MODE.WINDOW_MANAGEMENT) return;
	this.selectedMoveItem = moveItem;
	this.selectedScrollItem = null;
	this.selectOffsetX = this.selectedMoveItem.left - pointerX;
	this.selectOffsetY = this.selectedMoveItem.top - pointerY;
};

interaction.prototype.selectScrollItem = function(scrollItem) {
	if(this.interactionMode != MODE.WINDOW_MANAGEMENT) return;
	
	this.selectedMoveItem = null;
	this.selectedScrollItem = scrollItem;
};

interaction.prototype.releaseItem = function() {
	if(this.interactionMode != MODE.WINDOW_MANAGEMENT) return;
	
	this.selectedMoveItem = null;
	this.selectedScrollItem = null;
};

interaction.prototype.moveSelectedItem = function(pointerX, pointerY) {
	if(this.interactionMode != MODE.WINDOW_MANAGEMENT) return;
	if(this.selectedMoveItem == null) return null;
	
	this.selectedMoveItem.left = pointerX + this.selectOffsetX;
	this.selectedMoveItem.top = pointerY + this.selectOffsetY;
	
	return {elemId: this.selectedMoveItem.id, elemLeft: this.selectedMoveItem.left, elemTop: this.selectedMoveItem.top, elemWidth: this.selectedMoveItem.width, elemHeight: this.selectedMoveItem.height, date: new Date()};
};

interaction.prototype.scrollSelectedItem = function(scale) {
	if(this.interactionMode != MODE.WINDOW_MANAGEMENT) return;
	if(this.selectedScrollItem == null) return null;
	
	var iWidth = this.selectedScrollItem.width * scale;
	var iHeight = iWidth / this.selectedScrollItem.aspect;
	if(iWidth < 40){
		iWidth = 40;
		iHeight = iWidth / this.selectedScrollItem.aspect;
	}
	if(iHeight < 40){
		iHeight = 40;
		iWidth = iHeight * this.selectedScrollItem.aspect;
	}
	var iCenterX = this.selectedScrollItem.left + (this.selectedScrollItem.width/2);
	var iCenterY = this.selectedScrollItem.top + (this.selectedScrollItem.height/2);
	
	this.selectedScrollItem.left = iCenterX - (iWidth/2);
	this.selectedScrollItem.top = iCenterY - (iHeight/2);
	this.selectedScrollItem.width = iWidth;
	this.selectedScrollItem.height = iHeight;
	
	return {elemId: this.selectedScrollItem.id, elemLeft: this.selectedScrollItem.left, elemTop: this.selectedScrollItem.top, elemWidth: this.selectedScrollItem.width, elemHeight: this.selectedScrollItem.height, date: new Date()};
};

interaction.prototype.isWindowManagementMode = function() {
	return this.interactionMode == MODE.WINDOW_MANAGEMENT;
};

interaction.prototype.isAppInteractionMode = function() {
	return this.interactionMode == MODE.APP_INTERACTION;
};

interaction.prototype.selectWindowManagementMode = function() {
	this.interactionMode = MODE.WINDOW_MANAGEMENT;
	
	this.selectedMoveItem = null;
	this.selectedScrollItem = null;
};

interaction.prototype.selectAppInteractionMode = function() {
	this.interactionMode = MODE.APP_INTERACTION;
	console.log("interaction: " + this.interactionMode);
	
	this.selectedMoveItem = null;
	this.selectedScrollItem = null;
};

interaction.prototype.toggleModes = function(){
    if( this.interactionMode == MODE.WINDOW_MANAGEMENT )
        this.interactionMode = MODE.APP_INTERACTION; 
    else if( this.interactionMode ==  MODE.APP_INTERACTION )
        this.interactionMode = MODE.WINDOW_MANAGEMENT;
    
    this.selectedMoveItem = null;
	this.selectedScrollItem = null;
};

interaction.prototype.windowManagementMode = function(){
    return this.interactionMode == MODE.WINDOW_MANAGEMENT;
};

interaction.prototype.appInteractionMode = function(){
    return this.interactionMode == MODE.APP_INTERACTION;
};

module.exports = interaction;
